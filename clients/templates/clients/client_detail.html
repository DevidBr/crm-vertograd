{% extends 'dashboard/base_dashboard.html' %}
{% load static %}

{% block content %}
<div class="client_card card" style="border-radius: 15px">
    <div class="card card-body mb-3" style="border-radius: 15px">
        <div class="card p-3" style="border-radius: 15px">
            <h3 class="card-title">{{ client.name }}</h3>
            <div class="card-text">
                <ul>
                    <li>
                        Описание: {{ client.type_of_activity }}
                    </li>
                    <li>
                        ИНН: {{ client.inn }}
                    </li>
                    <li>
                        Город: {{ client.city }}
                    </li>
                    <li>
                        Телефон: {{ client.telephone }}
                    </li>
                    <li>
                        email: {{ client.email }}
                    </li>
                    <li>
                        Адрес: {{ client.city }}, {{ client.address }}
                    </li>
                    <li>
                        Менеджер: {{ client.manager.first_name }} {{ client.manager.last_name }}
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="contacts">
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseContactList"
                aria-expanded="false" aria-controls="collapseContactList" style="margin-bottom: 20px">
            Контактные лица
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-down" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1"/>
            </svg>
        </button>
        <div class="collapse" id="collapseContactList">
            <div class="card card-body mb-3" style="border-radius: 15px">
                {% for contact in client.contact_person.all %}
                <div class="card mb-3" style="border-radius: 15px">
                    <div class="card-body">
                        <h4 class="card-title">
                            {{ contact.name }} |
                            <a class="btn btn-success" href="{{ contact.get_absolute_url }}">
                                Открыть карточку контактного лица
                            </a>
                        </h4>
                        <div class="card-subtitle mb-2 text-muted">{{ contact.job_title }}</div>
                        <div class="card-text">

                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
                                    <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.6 17.6 0 0 0 4.168 6.608 17.6 17.6 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.68.68 0 0 0-.58-.122l-2.19.547a1.75 1.75 0 0 1-1.657-.459L5.482 8.062a1.75 1.75 0 0 1-.46-1.657l.548-2.19a.68.68 0 0 0-.122-.58zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877z"/>
                                    </svg>
                                    : {{ contact.telephone }}
                                </li>
                                <li class="list-group-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-envelope-at" viewBox="0 0 16 16">
                                <path d="M2 2a2 2 0 0 0-2 2v8.01A2 2 0 0 0 2 14h5.5a.5.5 0 0 0 0-1H2a1 1 0 0 1-.966-.741l5.64-3.471L8 9.583l7-4.2V8.5a.5.5 0 0 0 1 0V4a2 2 0 0 0-2-2zm3.708 6.208L1 11.105V5.383zM1 4.217V4a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v.217l-7 4.2z"/>
                                <path d="M14.247 14.269c1.01 0 1.587-.857 1.587-2.025v-.21C15.834 10.43 14.64 9 12.52 9h-.035C10.42 9 9 10.36 9 12.432v.214C9 14.82 10.438 16 12.358 16h.044c.594 0 1.018-.074 1.237-.175v-.73c-.245.11-.673.18-1.18.18h-.044c-1.334 0-2.571-.788-2.571-2.655v-.157c0-1.657 1.058-2.724 2.64-2.724h.04c1.535 0 2.484 1.05 2.484 2.326v.118c0 .975-.324 1.39-.639 1.39-.232 0-.41-.148-.41-.42v-2.19h-.906v.569h-.03c-.084-.298-.368-.63-.954-.63-.778 0-1.259.555-1.259 1.4v.528c0 .892.49 1.434 1.26 1.434.471 0 .896-.227 1.014-.643h.043c.118.42.617.648 1.12.648m-2.453-1.588v-.227c0-.546.227-.791.573-.791.297 0 .572.192.572.708v.367c0 .573-.253.744-.564.744-.354 0-.581-.215-.581-.8Z"/>
                                </svg>
                                    : {{ contact.email }}
                                </li>
                                <li class="list-group-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="green" class="bi bi-whatsapp" viewBox="0 0 16 16">
                                <path d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.73.73 0 0 0-.529.247c-.182.198-.691.677-.691 1.654s.71 1.916.81 2.049c.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232"/>
                                </svg>
                                    : {{ contact.whatsapp }}
                                </li>
                                <li class="list-group-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#3390EC" class="bi bi-telegram" viewBox="0 0 16 16">
                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8.287 5.906q-1.168.486-4.666 2.01-.567.225-.595.442c-.03.243.275.339.69.47l.175.055c.408.133.958.288 1.243.294q.39.01.868-.32 3.269-2.206 3.374-2.23c.05-.012.12-.026.166.016s.042.12.037.141c-.03.129-1.227 1.241-1.846 1.817-.193.18-.33.307-.358.336a8 8 0 0 1-.188.186c-.38.366-.664.64.015 1.088.327.216.589.393.85.571.284.194.568.387.936.629q.14.092.27.187c.331.236.63.448.997.414.214-.02.435-.22.547-.82.265-1.417.786-4.486.906-5.751a1.4 1.4 0 0 0-.013-.315.34.34 0 0 0-.114-.217.53.53 0 0 0-.31-.093c-.3.005-.763.166-2.984 1.09"/>
                                </svg>
                                    : {{ contact.telegram }}
                                </li>

                            </ul>
                        </div>
                    </div>
                </div>
                {% endfor %}

                <a  href="{% url 'clients:client_add_contact' client_id=client.id %}" class="btn btn-success w-50" style="color: white !important">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-add" viewBox="0 0 16 16">
                    <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0m-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/>
                    <path d="M8.256 14a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1z"/>
                    </svg>
                     Добавить еще контактное лицо в <b>{{ client.name }}</b>
                </a>

            </div>

        </div>
    </div>

    <div class="deals">
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDealList"
        aria-expanded="false" aria-controls="collapseDealList" style="margin-bottom: 20px">Сделки
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-down" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1"/>
            </svg>
        </button>
        <div class="collapse" id="collapseDealList">
            <div class="card card-body mb-3" style="border-radius: 15px">
                {% if client.deals.all.count == 0 %}
                <p>Сделок пока нет</p>
                {% else %}
                {% for deal in client.deals.all %}
                {% if deal.status != "14" and deal.status != "15" and deal.status != "16"%}
                <div class="card mb-3" style="border-radius: 15px">
                    <div class="card-body">
                        <h4 class="card-title">{{ client.name }}</h4>
                        <div class="card-subtitle">
                            {% if deal.service %}<p style="color: blue">Услуга: {{ deal.service }}</p>
                            {% else %} <p style="color: red">Услуга пока не определена.</p>
                            {% endif %}
                        </div>
                        <div class="card-text">
                            <ul>
                                <li>
                                    Статус сделки: {{ deal.get_status_display }}
                                </li>
                                <li>
                                    Сделка создана: {{ deal.created_date }}
                                </li>
                                <li>
                                    Последние изменение: {{ deal.updated_date }}
                                </li>
                                <li>
                                    {% if deal.contract_number %}Договор: <p style="color: blue">{{ deal.contract_number }}</p>
                                    {% else %}<p style="color: red">Договора пока нет</p>{% endif %}
                                </li>
                                <hr>
                                {% if deal.cost_price %}
                                <li>
                                    Себестоимость: ₽{{ deal.cost_price|floatformat:"g" }}
                                </li>
                                {% endif %}
                                {% if deal.price %}
                                <li>
                                    Стоимость: ₽{{ deal.price|floatformat:"g" }}
                                </li>
                                {% endif %}
                                {% if deal.price and deal.cost_price %}
                                <li>
                                    Ожидаемая прибыль: ₽{{ deal.get_net_profit|floatformat:"g" }}
                                </li>
                                {% endif %}
                            </ul>
                            <a href="{{ deal.get_absolute_url }}" class="btn btn-success" style="color: white !important">
                                Зайти в сделку
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hand-index" viewBox="0 0 16 16">
                                <path d="M6.75 1a.75.75 0 0 1 .75.75V8a.5.5 0 0 0 1 0V5.467l.086-.004c.317-.012.637-.008.816.027.134.027.294.096.448.182.077.042.15.147.15.314V8a.5.5 0 1 0 1 0V6.435l.106-.01c.316-.024.584-.01.708.04.118.046.3.207.486.43.081.096.15.19.2.259V8.5a.5.5 0 0 0 1 0v-1h.342a1 1 0 0 1 .995 1.1l-.271 2.715a2.5 2.5 0 0 1-.317.991l-1.395 2.442a.5.5 0 0 1-.434.252H6.035a.5.5 0 0 1-.416-.223l-1.433-2.15a1.5 1.5 0 0 1-.243-.666l-.345-3.105a.5.5 0 0 1 .399-.546L5 8.11V9a.5.5 0 0 0 1 0V1.75A.75.75 0 0 1 6.75 1M8.5 4.466V1.75a1.75 1.75 0 1 0-3.5 0v5.34l-1.2.24a1.5 1.5 0 0 0-1.196 1.636l.345 3.106a2.5 2.5 0 0 0 .405 1.11l1.433 2.15A1.5 1.5 0 0 0 6.035 16h6.385a1.5 1.5 0 0 0 1.302-.756l1.395-2.441a3.5 3.5 0 0 0 .444-1.389l.271-2.715a2 2 0 0 0-1.99-2.199h-.581a5 5 0 0 0-.195-.248c-.191-.229-.51-.568-.88-.716-.364-.146-.846-.132-1.158-.108l-.132.012a1.26 1.26 0 0 0-.56-.642 2.6 2.6 0 0 0-.738-.288c-.31-.062-.739-.058-1.05-.046zm2.094 2.025"/>
                                </svg>

                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}


                {% endfor %}
                {% endif %}

                <a href="{% url 'deals:add_deal' client_id=client.id  %}" class="btn btn-warning"><b>+</b>
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000" height="20px" width="20px" version="1.1" id="Layer_1" viewBox="0 0 475.479 475.479" xml:space="preserve">
                <g id="XMLID_489_">
                <path id="XMLID_490_" d="M471.085,201.536L329.663,60.116c-5.857-5.857-15.354-5.858-21.213,0l-42.427,42.425v0h-0.001   l-31.819,31.82l-31.817-31.819h-0.001v-0.001l-42.429-42.426c-5.858-5.857-15.355-5.858-21.213,0L4.394,194.466   C1.58,197.279,0,201.095,0,205.073c0,3.979,1.581,7.794,4.394,10.607l42.427,42.426c2.929,2.929,6.768,4.393,10.606,4.393   c2.212,0,4.418-0.502,6.456-1.475l145.568,145.57c0.002,0.001,0.003,0.003,0.004,0.005c8.773,8.772,20.297,13.158,31.82,13.158   c11.523,0,23.047-4.386,31.819-13.159c7.914-7.913,12.512-18.255,13.109-29.344c10.675-0.589,21.18-4.946,29.317-13.082   c8.144-8.144,12.5-18.658,13.085-29.342c10.684-0.584,21.199-4.941,29.342-13.084c0.006-0.006,0.012-0.013,0.019-0.02   l53.634-53.634c1.999,0.954,4.195,1.478,6.452,1.478c3.978,0,7.794-1.581,10.606-4.393l42.427-42.427   c2.813-2.813,4.394-6.628,4.394-10.606C475.479,208.164,473.898,204.349,471.085,201.536z M36.213,205.073L149.351,91.935   l21.215,21.213l-4.466,4.466L57.427,226.286L36.213,205.073z M294.308,342.959c-5.846,5.845-15.357,5.847-21.207,0.007   c-0.002-0.002-0.004-0.005-0.007-0.008l-21.214-21.213c-5.858-5.857-15.356-5.857-21.213,0c-5.857,5.858-5.857,15.355,0.001,21.213   l21.21,21.209c0.001,0.001,0.003,0.003,0.004,0.005c0.002,0.002,0.004,0.004,0.006,0.006c2.829,2.832,4.387,6.596,4.387,10.599   c0,4.006-1.56,7.773-4.394,10.608c-5.848,5.848-15.365,5.848-21.214-0.001c-0.001-0.001-0.003-0.003-0.005-0.004L85.712,240.427   l106.067-106.066l21.212,21.213l-31.819,31.82c-0.003,0.003-0.006,0.007-0.009,0.01c-17.535,17.546-17.533,46.087,0.008,63.63   c8.773,8.773,20.296,13.16,31.82,13.16c11.523,0,23.046-4.386,31.818-13.158c0,0,0-0.001,0.001-0.001l31.82-31.82l53.026,53.026   c0.002,0.003,0.004,0.004,0.006,0.007l7.085,7.084c2.825,2.832,4.381,6.592,4.381,10.592c0,4.002-1.558,7.765-4.384,10.597   l-0.01,0.01c-0.001,0.001-0.003,0.003-0.004,0.005c-5.847,5.84-15.351,5.841-21.2,0.005c-0.005-0.005-0.009-0.01-0.014-0.015   l-21.209-21.208c-5.858-5.857-15.356-5.857-21.213,0.001c-5.857,5.858-5.857,15.355,0,21.213l21.2,21.199   c0.005,0.005,0.009,0.01,0.014,0.015C300.156,327.594,300.156,337.11,294.308,342.959z M368.554,268.712l-10.602-10.602   c-0.002-0.001-0.003-0.004-0.005-0.005c-0.001-0.001-0.002-0.001-0.002-0.003l-7.069-7.069c0-0.001-0.001-0.001-0.002-0.002   l-63.637-63.637c-2.813-2.813-6.628-4.393-10.606-4.393c-3.978,0-7.794,1.58-10.606,4.393l-42.426,42.426   c-5.849,5.85-15.366,5.849-21.214,0.001c-5.847-5.848-5.848-15.363-0.001-21.212c0.001-0.001,0.001-0.001,0.002-0.002   l42.414-42.415c0.004-0.003,0.008-0.006,0.012-0.01c0.004-0.004,0.007-0.008,0.011-0.012l31.809-31.81l113.137,113.138   L368.554,268.712z M418.052,233.356L297.843,113.147l21.213-21.212l120.208,120.208L418.052,233.356z"></path>
                </g></svg>
                    Добавить новую сделку для клиента <b>{{ client.name }}</b></a>
            </div>
        </div>
    </div>

</div>
{% endblock %}